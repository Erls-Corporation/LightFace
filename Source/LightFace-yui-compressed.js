/*
	Inspired by Bert Ramaker's Facebox for jQuery and MooTools:  http://bertramakers.com/labs/
	Rewritten and optimized by David Walsh:  http://davidwalsh.name
*/
/*
---
description:     LightFace

authors:
  - David Walsh (http://davidwalsh.name)

license:
  - MIT-style license

requires:
  core/1.2.1:   '*'

provides:
  - LightFace
  - LightFace.IFrame
  - LightFace.Image
  - LightFace.Request
  - LightFace.Static
...
*/
var LightFace=new Class({Implements:[Options,Events],options:{width:"auto",height:"auto",draggable:false,title:"",buttons:[],fadeDelay:400,fadeDuration:400,keys:{esc:function(){this.close()}},content:"<p>Message not specified.</p>",zIndex:9001,pad:100,overlayAll:false,constrain:false,resetOnScroll:true,baseClass:"lightface",errorMessage:"<p>The requested file could not be found.</p>"},initialize:function(a){this.setOptions(a);this.state=false;this.buttons={};this.resizeOnOpen=true;this.ie6=typeof document.body.style.maxHeight=="undefined";this.draw()},draw:function(){this.box=new Element("table",{"class":this.options.baseClass,styles:{"z-index":this.options.zIndex,opacity:0},tween:{duration:this.options.fadeDuration,onComplete:function(){if(this.box.getStyle("opacity")==0){this.box.setStyles({top:-9000,left:-9000})}}.bind(this)}}).inject(document.body,"bottom");var h=["top","center","bottom"],e=["Left","Center","Right"],c=h.length;for(var b=0;b<c;b++){var f=this.box.insertRow(b);for(var g=0;g<c;g++){var d=h[b]+e[g],a=f.insertCell(g);a.className=d;if(d=="centerCenter"){this.contentBox=new Element("div",{"class":"lightfaceContent",styles:{width:this.options.width}});a.appendChild(this.contentBox)}else{document.id(a).setStyle("opacity",0.4)}}}if(this.options.title){this.title=new Element("h2",{"class":"lightfaceTitle",html:this.options.title}).inject(this.contentBox);if(this.options.draggable&&$defined(window.Drag)){this.draggable=true;new Drag(this.box,{handle:this.title});this.title.addClass("lightfaceDraggable")}}this.messageBox=new Element("div",{"class":"lightfaceMessageBox",html:this.options.content||"",styles:{height:this.options.height}}).inject(this.contentBox);this.footer=new Element("div",{"class":"lightfaceFooter",styles:{display:"none"}}).inject(this.contentBox);this.overlay=new Element("div",{html:"&nbsp;",styles:{opacity:0},"class":"lightfaceOverlay",tween:{link:"chain",duration:this.options.fadeDuration,onComplete:function(){if(this.overlay.getStyle("opacity")==0){this.box.focus()}}.bind(this)}}).inject(this.contentBox);if(!this.options.overlayAll){this.overlay.setStyles({top:(this.title?this.title.getSize().y:0)})}this.buttons=[];if(this.options.buttons.length){this.options.buttons.each(function(i){this.addButton(i.title,i.event,i.color)},this)}this.focusNode=this.box;return this},addButton:function(e,a,b){this.footer.setStyle("display","block");var d="lightfacefocus"+b;var c=new Element("label",{"class":b?"lightface"+b:"",events:{mousedown:function(){if(b){c.addClass(d);var f=function(){c.removeClass(d);document.id(document.body).removeEvent("mouseup",f)};document.id(document.body).addEvent("mouseup",f)}}}});this.buttons[e]=(new Element("input",{type:"button",value:e,events:{click:(a||this.close).bind(this)}}).inject(c));c.inject(this.footer);return this},showButton:function(a){if(this.buttons[a]){this.buttons[a].removeClass("hiddenButton")}return this.buttons[a]},hideButton:function(a){if(this.buttons[a]){this.buttons[a].addClass("hiddenButton")}return this.buttons[a]},close:function(a){if(this.isOpen){this.box[a?"setStyles":"tween"]("opacity",0);this.fireEvent("close");this._detachEvents();this.isOpen=false}return this},open:function(a){if(!this.isOpen){this.box[a?"setStyles":"tween"]("opacity",1);if(this.resizeOnOpen){this._resize()}this.fireEvent("open");this._attachEvents();(function(){this._setFocus()}).bind(this).delay(this.options.fadeDuration+10);this.isOpen=true}return this},_setFocus:function(){this.focusNode.setAttribute("tabIndex",0);this.focusNode.focus()},fade:function(b,a){this._ie6Size();(function(){this.overlay.setStyle("opacity",b||1)}.bind(this)).delay(a||0);this.fireEvent("fade");return this},unfade:function(a){(function(){this.overlay.fade(0)}.bind(this)).delay(a||this.options.fadeDelay);this.fireEvent("unfade");return this},_ie6Size:function(){if(this.ie6){var a=this.contentBox.getSize();var b=(this.options.overlayAll||!this.title)?0:this.title.getSize().y;this.overlay.setStyles({height:a.y-b,width:a.x})}},load:function(a,b){if(a){this.messageBox.set("html",a)}if(b&&this.title){this.title.set("html",b)}this.fireEvent("complete");return this},_attachEvents:function(){this.keyEvent=function(a){if(this.options.keys[a.key]){this.options.keys[a.key].call(this)}}.bind(this);this.focusNode.addEvent("keyup",this.keyEvent);this.resizeEvent=this.options.constrain?function(a){this._resize()}.bind(this):function(){this._position()}.bind(this);window.addEvent("resize",this.resizeEvent);if(this.options.resetOnScroll){this.scrollEvent=function(){this._position()}.bind(this);window.addEvent("scroll",this.scrollEvent)}return this},_detachEvents:function(){this.focusNode.removeEvent("keyup",this.keyEvent);window.removeEvent("resize",this.resizeEvent);if(this.scrollEvent){window.removeEvent("scroll",this.scrollEvent)}return this},_position:function(){var a=window.getSize(),b=window.getScroll(),c=this.box.getSize();this.box.setStyles({left:b.x+((a.x-c.x)/2),top:b.y+((a.y-c.y)/2)});this._ie6Size();return this},_resize:function(){var b=this.options.height;if(b=="auto"){var a=window.getSize().y-this.options.pad;if(this.contentBox.getSize().y>a){b=a}}this.messageBox.setStyle("height",b);this._position()},toElement:function(){return this.messageBox},getBox:function(){return this.box},destroy:function(){this._detachEvents();this.button.each(function(a){a.removeEvents("click")});this.box.dispose()}});LightFace.IFrame=new Class({Extends:LightFace,options:{url:""},initialize:function(a){this.parent(a);if(this.options.url){this.load()}},load:function(a,b){this.fade();if(!this.iframe){this.messageBox.set("html","");this.iframe=new IFrame({styles:{width:"100%",height:"100%"},events:{load:function(){this.unfade();this.fireEvent("complete")}.bind(this)},border:0}).inject(this.messageBox);this.messageBox.setStyles({padding:0,overflow:"hidden"})}if(b){this.title.set("html",b)}this.iframe.src=a||this.options.url;this.fireEvent("request");return this}});LightFace.Image=new Class({Extends:LightFace,options:{constrain:true,url:""},initialize:function(a){this.parent(a);this.url="";this.resizeOnOpen=false;if(this.options.url){this.load()}},_resize:function(){var b=window.getSize().y-this.options.pad;var a=document.id(this.image).retrieve("dimensions");if(a.y>b){this.image.height=b;this.image.width=(a.x*(b/a.y));this.image.setStyles({height:b,width:(a.x*(b/a.y)).toInt()})}this.messageBox.setStyles({height:"",width:""});this._position()},load:function(a,c){var b={x:"",y:""};if(this.image){b=this.image.getSize()}this.messageBox.set("html","").addClass("lightFaceMessageBoxImage").setStyles({width:b.x,height:b.y});this._position();this.fade();this.image=new Element("img",{events:{load:function(){(function(){var d=function(){this.image.inject(this.messageBox).store("dimensions",this.image.getSize())}.bind(this);d();this._resize();d();this.unfade();this.fireEvent("complete")}).bind(this).delay(10)}.bind(this),error:function(){this.fireEvent("error");this.image.destroy();delete this.image;this.messageBox.set("html",this.options.errorMessage).removeClass("lightFaceMessageBoxImage")}},style:"width:auto;height:auto;"});this.image.src=a||this.options.url;if(c&&this.title){this.title.set("html",c)}return this}});LightFace.Request=new Class({Extends:LightFace,options:{url:"",request:{url:false}},initialize:function(a){this.parent(a);if(this.options.url){this.load()}},load:function(a,c){var b=$extend({onRequest:function(){this.fade();this.fireEvent("request")}.bind(this),onSuccess:function(d){this.messageBox.set("html",d);this.fireEvent("success")}.bind(this),onFailure:function(){this.messageBox.set("html",this.options.errorMessage);this.fireEvent("failure")}.bind(this),onComplete:function(){this._resize();this.messageBox.setStyle("opacity",1);this.unfade();this.fireEvent("complete")}.bind(this)},this.options.request);if(c&&this.title){this.title.set("html",c)}if(!b.url){b.url=a||this.options.url}new Request(b).send();return this}});LightFace.Static=new Class({Extends:LightFace,options:{offsets:{x:20,y:20}},open:function(b,a,c){this.parent(b);this._position(a,c)},_position:function(a,b){if(!$defined(a)){return}this.box.setStyles({top:b-this.options.offsets.y,left:a-this.options.offsets.x})}});